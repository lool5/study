{% extends 'tracker/base.html' %}

{% load static %}
{% load humanize %}



{% block title %}تفاصيل الأسبوع {{ week.number }} - {{ week.month.name|default:"بدون اسم" }}{% endblock %}

{% block content %}
<!-- إضافة مكتبات Bootstrap و Font Awesome و Google Fonts -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

<style>
    :root {
        --primary-color: #3b82f6;
        --secondary-color: #10b981;
        --accent-color: #f59e0b;
        --danger-color: #ef4444;
        --dark-bg: #0f172a;
        --card-bg: rgba(31, 41, 55, 0.7);
        --border-color: rgba(255, 255, 255, 0.15);
        --text-light: #f3f4f6;
        --text-muted: #9ca3af;
    }

    body {
        background: linear-gradient(135deg, #1e40af, #0f172a);
        font-family: 'Tajawal', sans-serif;
        color: var(--text-light);
        line-height: 1.6;
        direction: rtl;
    }

    .glass-card {
        background: var(--card-bg);
        border-radius: 12px;
        backdrop-filter: blur(12px);
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        padding: 1.5rem;
    }

    .card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card.border-primary {
        border-color: var(--primary-color);
    }
    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .card-title {
        font-family: 'Tajawal', sans-serif;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text-light);
    }

    .card p {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
    }

    .star {
        color: var(--accent-color);
        font-size: 1.2rem;
        animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    .btn-custom, .btn-success, .btn-secondary {
        font-family: 'Tajawal', sans-serif;
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
        transition: background-color 0.3s, transform 0.2s;
    }
    .btn-custom {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: var(--text-light);
    }
    .btn-custom:hover {
        background-color: #2563eb;
        transform: translateY(-2px);
    }
    .btn-success {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
        color: var(--text-light);
    }
    .btn-success:hover {
        background-color: #059669;
        transform: translateY(-2px);
    }
    .btn-secondary {
        background-color: var(--text-muted);
        border-color: var(--text-muted);
        color: var(--text-light);
    }
    .btn-secondary:hover {
        background-color: #6b7280;
        transform: translateY(-2px);
    }

    .form-control {
        font-family: 'Tajawal', sans-serif;
        font-size: 0.85rem;
        background-color: #1e293b;
        color: var(--text-light);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 0.4rem;
        transition: border-color 0.3s, box-shadow 0.3s;
        direction: ltr;
        text-align: left;
        unicode-bidi: embed;
    }
    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 6px rgba(59, 130, 246, 0.5);
    }

    .text-muted {
        color: var(--text-muted) !important;
    }
</style>

<div class="container py-5" dir="rtl">
    <div class="text-center mb-4">
        <h2 class="text-white fw-bold display-6"><i class="fas fa-calendar-week me-2"></i>أسبوع {{ week.number }} - {{ week.month.name|default:"بدون اسم" }} ({{ week.stars|floatformat:0|default:"0" }} نجمة)</h2>
    </div>
    <div class="row justify-content-center g-3">
        {% for day in days %}
        <div class="col-md-2 col-sm-3">
            <div class="card glass-card p-3 text-center h-100 {% if day.cyber_hours|add:day.english_hours > 0 %}border-primary{% endif %}">
                <h6 class="card-title">{{ day.date|date:"d/m (E)"|default:"غير متاح" }}</h6>
                <p class="mb-2">سايبر: {{ day.cyber_hours|floatformat:1|default:"0" }} ساعة</p>
                <p class="mb-2">إنجليزي: {{ day.english_hours|floatformat:1|default:"0" }} ساعة</p>
                <p class="mb-2 fw-bold">إجمالي: {{ day.cyber_hours|add:day.english_hours|floatformat:1|default:"0" }} ساعة</p>
                {% if day.star %}
                <span class="star"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i> (3 نجوم)</span>
                {% else %}
                <p class="mb-0">لا نجوم</p>
                {% endif %}
                <a href="{% url 'day_detail' day.id %}" class="btn btn-custom btn-sm mt-2"><i class="fas fa-pencil-alt me-2"></i>تعديل اليوم</a>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center">
            <p class="text-muted fs-5">لا أيام مضافة لهذا الأسبوع. أضف يومًا!</p>
        </div>
        {% endfor %}
    </div>
    <form method="POST" class="mt-4 text-center">
        {% csrf_token %}
        <div class="input-group w-50 mx-auto">
            <input type="date" name="new_date" class="form-control" min="2025-10-01" max="2026-10-01">
            <button type="submit" class="btn btn-success"><i class="fas fa-plus me-2"></i>أضف يوم مرن</button>
        </div>
    </form>
    <a href="{% url 'month_detail' week.month.id %}" class="btn btn-secondary mt-3"><i class="fas fa-arrow-right me-2"></i>رجوع للشهر</a>
</div>

<!-- تحميل Bootstrap JS مع رد احتياطي -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    // التحقق من تحميل Bootstrap
    if (typeof bootstrap === 'undefined') {
        console.error('Bootstrap JS failed to load from CDN. Attempting to load local fallback.');
        document.write('<script src="{% static "js/bootstrap.bundle.min.js" %}"><\/script>');
    } else {
        console.log('Bootstrap JS loaded successfully from CDN.');
    }
</script>
{% endblock %}